!function(){"use strict";var dasherize=function(string){return string.replace(/_/g,"-").replace(/([a-z])([A-Z])/g,function(_,$1,$2){return $1+"-"+$2.toLowerCase()})},autoCompleteAttrs=["placeholder","listFormatter","prefillFunc","ngModel","valueChanged","source","pathToData","minChars","defaultStyle","valueProperty","displayProperty"],buildACDiv=function(attrs){var acDiv=document.createElement("auto-complete-div"),inputEl=document.createElement("input");attrs.ngDisabled&&inputEl.setAttribute("ng-disabled",attrs.ngDisabled),acDiv.appendChild(inputEl);var ulEl=document.createElement("ul");return acDiv.appendChild(ulEl),autoCompleteAttrs.map(function(attr){attrs[attr]&&acDiv.setAttribute(dasherize(attr),attrs[attr])}),acDiv.style.position="absolute",acDiv.style.top=0,acDiv.style.left=0,acDiv.style.display="none",acDiv},compileFunc=function(element,attrs){element[0].style.position="relative";var controlEl=element[0].querySelector("input, select");if(attrs.valueProperty=attrs.valueProperty||"id",attrs.displayProperty=attrs.displayProperty||"value",attrs.ngModel=controlEl.getAttribute("ng-model"),"SELECT"==controlEl.tagName){var placeholderEl=document.createElement("div");placeholderEl.className="select-placeholder",element[0].appendChild(placeholderEl)}var acDiv=buildACDiv(attrs);element[0].appendChild(acDiv)};angular.module("angularjs-autocomplete",["ngSanitize"]),angular.module("angularjs-autocomplete").directive("autoComplete",function(){return{compile:compileFunc}})}(),function(){"use strict";var $compile,dasherize=function(string){return string.replace(/_/g,"-").replace(/([a-z])([A-Z])/g,function(_,$1,$2){return $1+"-"+$2.toLowerCase()})},autoCompleteAttrs=["placeholder","multiple","listFormatter","prefillFunc","ngModel","valueChanged","source","pathToData","minChars","defaultStyle","valueProperty","displayProperty"],buildACDiv=function(attrs){var acDiv=document.createElement("auto-complete-div"),inputEl=document.createElement("input");attrs.placeholder=attrs.placeholder||"Select",inputEl.setAttribute("placeholder",attrs.placeholder),inputEl.setAttribute("size",attrs.placeholder.length),attrs.ngDisabled&&inputEl.setAttribute("ng-disabled",attrs.ngDisabled),acDiv.appendChild(inputEl);var ulEl=document.createElement("ul");return acDiv.appendChild(ulEl),autoCompleteAttrs.map(function(acAttr){if(attrs[acAttr]){var attrValue=attrs[acAttr];acDiv.setAttribute(dasherize(acAttr),attrValue)}}),acDiv.style.position="relative",acDiv},buildMultiACDiv=function(attrs){var deleteLink=document.createElement("button");deleteLink.innerHTML="x",deleteLink.className+=" delete",deleteLink.setAttribute("ng-click",attrs.ngModel+".splice($index, 1); $event.stopPropagation()");var ngRepeatDiv=document.createElement("span");ngRepeatDiv.className+=" auto-complete-repeat",ngRepeatDiv.setAttribute("ng-repeat","obj in "+attrs.ngModel+" track by $index"),attrs.listFormatter?ngRepeatDiv.innerHTML='<span ng-bind-html="listFormatter(obj)"></span>':ngRepeatDiv.innerHTML="<b>({{obj."+attrs.valueProperty+"}})</b><span>{{obj."+attrs.displayProperty+"}}</span>",ngRepeatDiv.appendChild(deleteLink);var multiACDiv=document.createElement("div");return multiACDiv.className="auto-complete-div-multi-wrapper",multiACDiv.appendChild(ngRepeatDiv),multiACDiv},compileFunc=function(element,attrs){element[0].style.position="relative";var controlEl=element[0].querySelector("select");controlEl.style.display="none",attrs.valueProperty=attrs.valueProperty||"id",attrs.displayProperty=attrs.displayProperty||"value",attrs.ngModel=controlEl.getAttribute("ng-model"),attrs.multiple=!0;var multiACDiv=buildMultiACDiv(attrs),acDiv=buildACDiv(attrs);multiACDiv.appendChild(acDiv),element[0].appendChild(multiACDiv)};angular.module("angularjs-autocomplete").directive("autoCompleteMulti",["$compile",function(_$compile_){return $compile=_$compile_,{compile:compileFunc}}])}(),function(){"use strict";var $timeout,$filter,AutoComplete,showLoading=function(ulEl,show){if(show)ulEl.innerHTML='<li class="loading"> Loading </li>';else{var loadingNode=ulEl.querySelector("li.loading");loadingNode&&ulEl.removeChild(loadingNode)}},defaultListFormatter=function(obj,scope){return"<b>("+obj[scope.valueProperty]+")</b><span>"+obj[scope.displayProperty]+"</span>"},addListElements=function(scope,data){var ulEl=scope.ulEl,getLiEl=function(el){var viewValue="object"==typeof el?el[scope.displayProperty]:el,modelValue="object"==typeof el?el[scope.valueProperty]:el,liEl=document.createElement("li");return scope.listFormatter&&"object"==typeof el?liEl.innerHTML=scope.listFormatter(el):liEl.innerHTML="object"==typeof el?defaultListFormatter(el,scope):viewValue,liEl.model=el,liEl.modelValue=modelValue,liEl.viewValue=viewValue,liEl};scope.placeholder&&!scope.multiple&&"SELECT"==scope.controlEl.tagName&&ulEl.appendChild(getLiEl(scope.placeholder)),data.forEach(function(el){ulEl.appendChild(getLiEl(el))})},delay=function(){var timer=0;return function(callback,ms){$timeout.cancel(timer),timer=$timeout(callback,ms)}}(),loadList=function(scope){for(var inputEl=scope.inputEl,ulEl=scope.ulEl;ulEl.firstChild;)ulEl.removeChild(ulEl.firstChild);if("Array"==scope.source.constructor.name){if(inputEl.value.length>=scope.minChars){var filteredData=$filter("filter")(scope.source,inputEl.value);ulEl.style.display="block",addListElements(scope,filteredData)}}else if(ulEl.style.display="none",inputEl.value.length>=(scope.minChars||0)){ulEl.style.display="block",showLoading(ulEl,!0);var query={keyword:inputEl.value};scope.ngModel&&(query.ngModel=scope.ngModel),AutoComplete.getRemoteData(scope.source,query,scope.pathToData).then(function(data){showLoading(ulEl,!1),addListElements(scope,data)},function(){showLoading(ulEl,!1)})}},hideAutoselect=function(scope){(scope.multiple?scope.ulEl:scope.containerEl).style.display="none"},focusInputEl=function(scope){scope.ulEl.style.display="block",scope.inputEl.focus(),scope.inputEl.value=""},inputElKeyHandler=function(scope,evt){var selected=scope.ulEl.querySelector(".selected");switch(evt.keyCode){case 27:selected.className="",hideAutoselect(scope);break;case 38:selected.previousSibling&&(selected.className="",selected.previousSibling.className="selected");break;case 40:scope.ulEl.style.display="block",selected&&selected.nextSibling?(selected.className="",selected.nextSibling.className="selected"):selected||(scope.ulEl.firstChild.className="selected");break;case 13:selected&&scope.select(selected),evt.preventDefault();break;case 8:scope.multiple&&""===scope.inputEl.value&&$timeout(function(){scope.ngModel.pop()})}},linkFunc=function(scope,element,attrs){var inputEl,ulEl,containerEl;scope.containerEl=containerEl=element[0],scope.inputEl=inputEl=element[0].querySelector("input"),scope.ulEl=ulEl=element[0].querySelector("ul");var parentEl,controlEl,placeholderEl;if(scope.multiple?(parentEl=element[0].parentElement.parentElement,scope.controlEl=controlEl=parentEl.querySelector("select")):(parentEl=element[0].parentElement,scope.controlEl=controlEl=parentEl.querySelector("input, select"),placeholderEl=parentEl.querySelector(".select-placeholder")),controlEl&&!scope.multiple){if(controlEl.readOnly=!0,"SELECT"==controlEl.tagName){var controlBCR=controlEl.getBoundingClientRect();placeholderEl.style.lineHeight=controlBCR.height+"px",scope.prefillFunc&&scope.prefillFunc().then(function(html){placeholderEl.innerHTML=html}),attrs.ngModel&&scope.$parent.$watch(attrs.ngModel,function(val){!val&&(placeholderEl.innerHTML=attrs.placeholder)}),controlEl.addEventListener("mouseover",function(){for(var i=0;i<controlEl.children.length;i++)controlEl.children[i].style.display="none"}),controlEl.addEventListener("mouseout",function(){for(var i=0;i<controlEl.children.length;i++)controlEl.children[i].style.display=""})}controlEl.addEventListener("click",function(){if(!controlEl.disabled){containerEl.style.display="block";var controlBCR=controlEl.getBoundingClientRect();containerEl.style.width=controlBCR.width+"px",inputEl.style.width=controlBCR.width-30+"px",inputEl.style.height=controlBCR.height+"px",inputEl.focus()}})}else scope.multiple&&(scope.prefillFunc&&scope.prefillFunc(),parentEl.addEventListener("click",function(){controlEl&&(inputEl.disabled=controlEl.disabled,controlEl.disabled||(containerEl.style.display="inline-block",inputEl.focus()))}));!1!==scope.defaultStyle&&(containerEl.className+=" default-style",AutoComplete.injectDefaultStyle()),scope.select=function(liEl){liEl.className="",hideAutoselect(scope),$timeout(function(){attrs.ngModel&&(scope.multiple?(scope.ngModel||(scope.ngModel=[]),scope.ngModel.push(liEl.model)):controlEl?"INPUT"==controlEl.tagName?scope.ngModel=liEl.innerHTML:"SELECT"==controlEl.tagName&&(scope.ngModel=liEl.modelValue,scope.listFormatter&&"object"==typeof liEl.model?placeholderEl.innerHTML=scope.listFormatter(liEl.model):placeholderEl.innerHTML=liEl.viewValue):scope.ngModel=liEl.modelValue),inputEl.value="",scope.valueChanged({value:liEl.model})})},inputEl.addEventListener("focus",function(){controlEl?!controlEl.disabled&&focusInputEl(scope):focusInputEl(scope)}),inputEl.addEventListener("blur",function(){hideAutoselect(scope)}),inputEl.addEventListener("keydown",function(evt){inputElKeyHandler(scope,evt)}),ulEl.addEventListener("mousedown",function(evt){if(evt.target!==ulEl){for(var liTag=evt.target;"LI"!==liTag.tagName;)liTag=liTag.parentElement;"LI"==liTag.tagName&&"loading"!=liTag.className&&scope.select(liTag)}}),inputEl.addEventListener("input",function(){var delayMs="Array"==scope.source.constructor.name?10:500;if(delay(function(){loadList(scope)},delayMs),scope.multiple){var placeholderLength=0;attrs.placeholder&&(placeholderLength=attrs.placeholder.length);var newSize=Math.max(placeholderLength,inputEl.value.length+1);inputEl.setAttribute("size",newSize)}})},autoCompleteDiv=function(_$timeout_,_$filter_,_AutoComplete_){return $timeout=_$timeout_,$filter=_$filter_,AutoComplete=_AutoComplete_,{restrict:"E",scope:{ngModel:"=",source:"=",minChars:"=",multiple:"=",defaultStyle:"=",listFormatter:"=",pathToData:"@",valueProperty:"@",displayProperty:"@",placeholder:"@",prefillFunc:"&",valueChanged:"&"},link:linkFunc}};autoCompleteDiv.$inject=["$timeout","$filter","AutoComplete"],angular.module("angularjs-autocomplete").directive("autoCompleteDiv",autoCompleteDiv)}(),function(){"use strict";var $q,$http,defaultStyle="div[auto-complete] select ~ div.select-placeholder {  position: absolute;   padding-left: 12px;  top: 0;  left: 0;  pointer-events: none;}auto-complete-div.default-style input {  outline: none;   border: 2px solid transparent;  border-width: 3px 2px;  margin: 0;  box-sizing: border-box;  background-clip: content-box;}select ~ auto-complete-div.default-style input {  border-width: 3px 3px;}auto-complete-div.default-style ul {  background-color: #fff;  margin-top: 2px;  display : none;  width : 100%;  overflow-y: auto;  list-style-type: none;  margin: 0;  padding: 0;  border: 1px solid #ccc;  box-sizing: border-box;}auto-complete-div.default-style ul li {  padding: 2px 5px;  border-bottom: 1px solid #eee;}auto-complete-div.default-style ul li.selected {  background-color: #ccc;}auto-complete-div.default-style ul li:last-child {  border-bottom: none;}auto-complete-div.default-style ul li:hover {  background-color: #ccc;}div .auto-complete-repeat {  display: inline-block;  padding: 3px;   background : #fff;  margin: 3px;  border: 1px solid #ccc;  border-radius: 5px;}div .auto-complete-repeat .delete {  margin: 0 3px;  color: red;  border: none;  background-color: transparent; }div .auto-complete-repeat .delete[disabled] {  display: none;}.auto-complete-div-multi-wrapper {  background-color: #ddd;  min-height: 2em;}.auto-complete-div-multi-wrapper auto-complete-div.default-style {  position: relative;  display: inline-block;  margin: 3px;  padding: 3px;}.auto-complete-div-multi-wrapper auto-complete-div.default-style input {  background: transparent;  border-radius: 0;  border: none;}.auto-complete-div-multi-wrapper auto-complete-div.default-style ul {  position: absolute;  top: 1.5em;  left: 0;  width: auto;  min-width: 10em;}",dasherize=function(string){return string.replace(/_/g,"-").replace(/([a-z])([A-Z])/g,function(_,$1,$2){return $1+"-"+$2.toLowerCase()})},getStyle=function(el,styleProp){return document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp)},injectDefaultStyleToHead=function(){if(!document.querySelector("style#auto-complete-style")){var htmlDiv=document.createElement("div");htmlDiv.innerHTML='<b>1</b><style id="auto-complete-style">'+defaultStyle+"</style>",document.getElementsByTagName("head")[0].appendChild(htmlDiv.childNodes[1])}},getRemoteData=function(source,query,pathToData){var httpGet,deferred=$q.defer();if("string"==typeof source){var keyValues=[];for(var key in query){var regexp=new RegExp(key,"g");source.match(regexp)?source=source.replace(regexp,query[key]):keyValues.push(key+"="+query[key])}if(keyValues.length){var qs=keyValues.join("&");source+=source.match(/\?[a-z]/i)?qs:"?"+qs}httpGet=$http.get(source)}else if(source.$promise)httpGet=source(query).$promise;else if("function"==typeof source&&(httpGet=source(query),httpGet.$promise&&(httpGet=source(query).$promise),!httpGet.then))throw"source function must return a promise";return httpGet.then(function(resp){var list="Resource"==resp.constructor.name?resp:resp.data;if(pathToData){pathToData.split(".").forEach(function(el){list=list[el]})}deferred.resolve(list)},function(error){deferred.reject(error)}),deferred.promise};angular.module("angularjs-autocomplete").factory("AutoComplete",["$q","$http",function(_$q_,_$http_){return $q=_$q_,$http=_$http_,{defaultStyle:defaultStyle,dasherize:dasherize,getStyle:getStyle,getRemoteData:getRemoteData,injectDefaultStyle:injectDefaultStyleToHead}}])}();


angular.module("soatClientApp",["ngAnimate","ngResource","ngRoute","ngSanitize","ngTouch","entity-directives","ui.router","angularModalService","ui-notification","ngMaterial","ngMdIcons","ngMundialPayments","angularjs-autocomplete","vcRecaptcha"]).constant("ENV",{soatURL:MAIN+"/quotation_api",soatLandingURL:MAIN+"/landing_api",soatPaymentURL:MAIN+"/payment_api/vouchers",getInfo:"/info",getAbout:"/about",putVehicle:"/vehicle",postEmail:"/support_email",postVerification:"/verification",patchOwners:"/owners",getDepartments:"/departments",getCities:"/cities",getPolicies:"/policies",getPaymentAvailability:"/payment_availability",getPaymentStatus:"/payment/status",putDiscounts:"/discounts",getFaqs:"/faq",getRates:"/rate_info"}).run(["$mdDateLocale","$filter",function($mdDateLocale,$filter){$mdDateLocale.formatDate=function(date){return date||(date=new Date),$filter("date")(date,"dd/MM/yyyy")}}]).config(["NotificationProvider",function(NotificationProvider){NotificationProvider.setOptions({delay:8e3})}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("intermediaryURLInterceptor")}]).config(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!1)}]).config(["$qProvider",function($qProvider){$qProvider.errorOnUnhandledRejections(!1)}]).config(["$mundialPaymentsProvider",function($mundialPaymentsProvider){$mundialPaymentsProvider.initMundialProvider("https://cpm.segurosmundial.com.co","https://cpm.segurosmundial.com.co","Cl_2bbcb279e2014f8698a9b6e456abd988","usrMultisitio")}]);
!function(){"use strict";angular.module("soatClientApp").factory("intermediaryURLInterceptor",["$location",function($location){return{request:function(config){return"https://cpm.segurosmundial.com.co/api/Account/Auth"!==config.url&&(config.headers["intermediary-url"]=$location.$$host),config}}}])}();
!function(){"use strict";angular.module("soatClientApp").controller("HeaderController",function(headerFactory,$scope,$state){$scope.logo="",$scope.background_image="",$scope.isOpen=!1,$scope.$state=$state;$scope.moveMenu=function(){$scope.isOpen=!$scope.isOpen},$scope.openPolicies=function(){window.open("https://productos.mundialseguros.com.co/")},$scope.goTo=function(page){$state.go(page)},$scope.moveToDiv=function(divName){if("/"!==$state.current.url)return void(window.location.href=window.location.origin+"/#/#"+divName);var node=document.getElementById(divName);window.scrollTo(0,node.offsetTop+1),$scope.moveMenu()},function(response){$scope.primaryColor="#"+response.primary_color,$scope.secondaryColor="#"+response.secondary_color,$scope.mainBoxColor="#"+response.main_box_color,$scope.mainTextBoxColor="#"+response.main_box_text_color,$scope.backgroundOpacity=response.background_opacity/100,$scope.logo=response.logo,$scope.hasPolicies=response.sections.indexOf("policies")>-1,$scope.hasClub=response.sections.indexOf("clubs")>-1,$scope.hasHear=response.sections.indexOf("hear_you")>-1,$scope.hasRates=response.sections.indexOf("rates")>-1,$scope.hasFaqs=response.sections.indexOf("faqs")>-1,document.title=response.name,$scope.background_image=response.background_picture}(headerFactory.getInfoSaved())})}();
!function(){"use strict";angular.module("soatClientApp").factory("headerFactory",["$http","ENV",function($http,ENV){var info,primaryColor="white",secondaryColor="white",backgroundTextColor="white",mainBoxColor="white",mainBoxTextColor="white",notificationColor="red",inputBorderColor="white",inputBorderSize="1px",initStyles=function(){primaryColor="#"+info.primary_color,secondaryColor="#"+info.secondary_color,backgroundTextColor="#"+info.primary_background_text_color,mainBoxColor="#"+info.main_box_color,mainBoxTextColor="#"+info.main_box_text_color,notificationColor="#"+info.notification_color,inputBorderColor="#"+info.input_border_color,inputBorderSize=info.input_border_size+"px";var css=".responsiveMenu,.vcal-date--selected,.timeCircle,.checkmarkContainer .checkmark:after {background-color: "+primaryColor+";border: 1px solid "+primaryColor+";}.lineStep.stepColor,.circleStep.stepColor {border-color: "+primaryColor+";}.lineStep {border-color: "+mainBoxTextColor+";}.buttonHeader {color: "+backgroundTextColor+";}.menuHeaderButton div,.bar1,.bar2 {background-color: "+backgroundTextColor+";}.optionClassPrice,.colorDate,.amountBlue,.circleStep.stepColor,.discountText span,.subtitleDiscount,.headerTableRates,button.active .questionButton,.ratesContent button .classTitle .spaceBetween {color: "+primaryColor+";}.cal__header svg {fill: "+primaryColor+";}.stepButton,.ratesContent .footerRateTable {color: "+mainBoxColor+";background-color: "+secondaryColor+";}.lineThrough::after {border-bottom: 2px solid "+primaryColor+";}.tableRates,.faqsContent button.active,.ratesContent button.active {background-color: "+secondaryColor+"1F;border: 1px solid "+secondaryColor+";}.ui-notification {background-color: "+notificationColor+";}.mainBox,.firstBlock,.discountModal,.select-items,.select-selected,auto-complete-div input {background-color: "+mainBoxColor+";}.checkmark,.circleStep {border-color: "+mainBoxTextColor+";}.bodyStep,.titleStep,.faqsTitle,.circleStep,.faqsSubtitle,.discountModal,.faqsDescription,.classNameButton,.optionClassText,.faqsContent button,.faqsContent button a,.textAutorizathionBlock,.textAutorizathionBlock button,.ratesContent .tableRates table {color: "+mainBoxTextColor+";}.subtitleFirst,.informationBox,.select-selected,.select-items div,auto-complete-div input {color: "+inputBorderColor+";}.select-items,.informationBox,.select-selected {border-width: "+inputBorderSize+";}.select-items,.optionClass,.informationBox,.select-selected,.select-selected:after {border-color: "+inputBorderColor+";}",style=document.createElement("style");style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css)),document.getElementsByTagName("head")[0].appendChild(style)},getInfo=function(){var URL=ENV.soatURL+ENV.getInfo+"?time="+Date.now();return $http.get(URL).then(function(response){return info=response.data.intermediary,initStyles(),info})};return{getInfoSaved:function(){return info},getInfo:getInfo}}])}();
!function(){"use strict";var app=angular.module("entity-directives",[]);app.directive("headerContent",function(){return{restrict:"E",templateUrl:"main/header/header-content.html",controller:"HeaderController"}}),app.directive("firstPageContent",function(){return{restrict:"E",templateUrl:"main/header/firstPage/first-page-content.html",controller:"FirstPageController"}}),app.directive("firstStepContent",function(){return{restrict:"E",templateUrl:"main/header/steps/firstStep/first-step-content.html",controller:"FirstStepController"}}),app.directive("secondStepContent",function(){return{restrict:"E",templateUrl:"main/header/steps/secondStep/second-step-content.html",controller:"SecondStepController"}}),app.directive("thirdStepContent",function(){return{restrict:"E",templateUrl:"main/header/steps/thirdStep/third-step-content.html",controller:"ThirdStepController"}}),app.directive("voucherContent",function(){return{restrict:"E",templateUrl:"main/header/voucher/voucher-content.html",controller:"VoucherController"}}),app.directive("errorPageContent",function(){return{restrict:"E",templateUrl:"main/header/errorPage/error-page-content.html",controller:"errorPageController"}}),app.directive("faqsContent",function(){return{restrict:"E",templateUrl:"main/header/faqs/faqs-content.html",controller:"FaqsController"}}),app.directive("ratesContent",function(){return{restrict:"E",templateUrl:"main/header/rates/rates-content.html",controller:"RatesController"}})}();
angular.module("soatClientApp").config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$stateProvider.state("header",{template:"<header-content>",resolve:{infoResolve:function(headerFactory){return headerFactory.getInfo()}}}).state("header.firstPage",{url:"/",template:"<first-page-content>"}).state("header.firstStep",{url:"/primer-paso",template:"<first-step-content>",params:{secondStepData:null}}).state("header.secondStep",{url:"/segundo-paso",template:"<second-step-content>",params:{secondStepData:null}}).state("header.thirdStep",{url:"/tercer-paso",template:"<third-step-content>",params:{secondStepData:null}}).state("header.voucher",{url:"/voucher/:id",template:"<voucher-content>"}).state("header.errorPage",{url:"/error",template:"<error-page-content>",params:{redirect:null}}).state("header.faqs",{url:"/preguntas-frecuentes",template:"<faqs-content>"}).state("header.rates",{url:"/tarifas",template:"<rates-content>"}),$urlRouterProvider.otherwise("/"),$locationProvider.hashPrefix("")}]);
!function(){"use strict";angular.module("soatClientApp").controller("errorPageController",function($state,$scope,$stateParams){$scope.isIPRestriction=!1,$stateParams.redirect&&setTimeout(function(){$state.go("header.firstPage")},5e3)})}();
!function(){"use strict";angular.module("soatClientApp").controller("FaqsController",function(faqsFactory,$scope,Notification){$scope.faqs,$scope.search,faqsFactory.getFaqs(function(response,success){success?$scope.faqs=response:new Notification("Error al obtener las preguntas frecuentes")}),$scope.showAnswer=function(faq){for(var item in $scope.faqs)faq.id===$scope.faqs[item].id?faq.show=!faq.show:$scope.faqs[item].show=!1}})}();
!function(){"use strict";angular.module("soatClientApp").factory("faqsFactory",["$http","ENV",function($http,ENV){return{getFaqs:function(callback){var URL=ENV.soatLandingURL+ENV.getFaqs;return $http.get(URL).then(function(response){callback(response.data,!0)}).catch(function(errorResponse){callback(errorResponse,!1)})}}}])}();
!function(){"use strict";angular.module("soatClientApp").controller("FirstPageController",function(firstPageFactory,$scope,$state,Notification,$location,$window,headerFactory){$scope.email,$scope.phone,$scope.plate,$scope.terms=!1,$scope.haveVerification=!1,$scope.nameH,$scope.lastNameH,$scope.phoneH,$scope.emailH,$scope.messageH,$scope.sizeRecaptcha="normal",$scope.about,$scope.dataLoading=!1,$scope.validateURL=function(value){return value&&"null"!==value&&"undefined"!==value},$scope.showDivs=function(){const response=headerFactory.getInfoSaved();$scope.title=response.custom_main_page_title,$scope.titleColor="#"+response.primary_background_text_color,$scope.hasClub=response.sections.indexOf("clubs")>-1,$scope.hasHear=response.sections.indexOf("hear_you")>-1,response.analytics_key&&!document.getElementById("analyticsScript")&&initScript(response.analytics_key),response.pixel_key&&!document.getElementById("pixelScript")&&initPixelScript(response.pixel_key),$scope.validateURL(response.terms_url)&&($scope.about.terms_url=response.terms_url),$scope.validateURL(response.privacy_url)&&($scope.about.privacy_url=response.privacy_url),$scope.validateURL(response.facebook_url)&&($scope.about.facebook_url=response.facebook_url),$scope.validateURL(response.instagram_url)&&($scope.about.instagram_url=response.instagram_url),$scope.validateURL(response.twitter_url)&&($scope.about.twitter_url=response.twitter_url),$scope.validateURL(response.youtube_url)&&($scope.about.youtube_url=response.youtube_url)};!function(){firstPageFactory.getAbout(function(response,success){success?($scope.about=response.about,$scope.showDivs()):new Notification("Error al pedir términos y condiciones")})}(),$scope.openPDF=function(pdf){if($scope.about){var pdfURL="";"terms"===pdf?(pdfURL=$scope.about.terms_url,pdfURL.indexOf("http")<0&&($scope.about.terms_url="http://"+pdfURL),window.open($scope.about.terms_url)):(pdfURL=$scope.about.privacy_url,pdfURL.indexOf("http")<0&&($scope.about.privacy_url="http://"+pdfURL),window.open($scope.about.privacy_url))}else new Notification("Vuelva a intentar.")};const validateForm=function(){return!!$scope.terms||(new Notification("Debe aceptar términos y condiciones."),!1)},initPixelScript=function(pixelKey){const key=pixelKey,script=document.createElement("script");script.type="text/javascript",script.id="pixelScript",script.innerHTML="!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init', '"+key+"'); fbq('track', 'PageView');",(document.head||document.getElementsByTagName("head")[0]).appendChild(script)},initScript=function(analyticsKey){const key=analyticsKey,script=document.createElement("script");script.type="text/javascript",script.id="analyticsScript",script.src="https://www.googletagmanager.com/gtag/js?id="+key,(document.head||document.getElementsByTagName("head")[0]).appendChild(script);const script2=document.createElement("script");script2.type="text/javascript",script2.innerHTML="window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', '"+key+"', {'page_path': 'first-page'})",(document.head||document.getElementsByTagName("head")[0]).appendChild(script2)};$scope.openNetworkSocial=function(option){switch(option){case 0:window.open($scope.about.facebook_url);break;case 1:window.open($scope.about.twitter_url);break;case 2:window.open($scope.about.youtube_url);break;case 3:window.open($scope.about.instagram_url)}},$scope.onlyNumber=function(event){isNaN(Number(event.key))&&event.preventDefault()},$scope.verifyResponse=function(responseRecaptcha){$scope.verificationResponse={response:responseRecaptcha},firstPageFactory.postVerification($scope.verificationResponse,function(response,success){$scope.haveVerification=response.data.success,$scope.challenge_ts=response.data.challenge_ts})},$scope.expiredRecaptcha=function(){$scope.haveVerification=!1},$scope.redirectSingUp=function(){window.open("http://registro.tubeneficiomundial.com")},$scope.resizeWindow=function(){$window.innerWidth<600||768<$window.innerWidth&&$window.innerWidth<1150?$scope.sizeRecaptcha="compact":$scope.sizeRecaptcha="normal",angular.element($window).on("resize",function(){$window.innerWidth<600||768<$window.innerWidth&&$window.innerWidth<1150?$scope.sizeRecaptcha="compact":$scope.sizeRecaptcha="normal"})},$scope.resizeWindow(),$scope.sendMessage=function(){if($scope.haveVerification){const request={name:$scope.nameH+" "+$scope.lastNameH,phone:$scope.phoneH,email:$scope.emailH,message:$scope.messageH,response:$scope.verificationResponse.response,challenge_ts:$scope.challenge_ts};firstPageFactory.postSendEmail(request,function(response,success){new Notification(success?"Se ha enviado su mensaje con éxito.":"Error al enviar su mensaje, intente más tarde.")})}else new Notification("Verifica que no eres un robot")},$scope.submit=function(){if(validateForm()){$scope.dataLoading=!0;const info={email:$scope.email,phone:$scope.phone,plate:$scope.plate};firstPageFactory.putVehicle(info,function(response){200===response.status||304===response.status?$state.go("header.firstStep"):409===response.status?new Notification("El vehículo se encuentra asociado a un propietario con email distinto al proporcionado."):502===response.status?new Notification("No se obtuvo respuesta satisfactoria del WS de consulta."):503===response.status?$state.go("header.errorPage",{redirect:1}):422===response.status?new Notification("Verifique la información ingresada."):424===response.status&&new Notification("La placa no se encuentra registrada en el RUNT."),$scope.dataLoading=!1})}}})}();
!function(){"use strict";angular.module("soatClientApp").factory("firstPageFactory",["$http","ENV",function($http,ENV){var vehicle,getVehicleSaved=function(){return vehicle},putVehicle=function(request,callback){var URL=ENV.soatURL+ENV.putVehicle;return $http.put(URL,request).then(function(response){vehicle=response.data.vehicle,callback(response)}).catch(function(errorResponse){callback(errorResponse)})},getAbout=function(callback){var URL=ENV.soatURL+ENV.getAbout;return $http.get(URL).then(function(response){callback(response.data,!0)}).catch(function(errorResponse){callback(errorResponse,!1)})};return{postVerification:function(request,callback){var URL=ENV.soatLandingURL+ENV.postEmail+ENV.postVerification;return $http.post(URL,request).then(function(response){callback(response,!0)}).catch(function(errorResponse){callback(errorResponse,!1)})},getVehicleSaved:getVehicleSaved,postSendEmail:function(request,callback){var URL=ENV.soatLandingURL+ENV.postEmail;return $http.post(URL,request).then(function(response){callback(response,!0)}).catch(function(errorResponse){callback(errorResponse,!1)})},putVehicle:putVehicle,getAbout:getAbout}}])}();
!function(){"use strict";angular.module("soatClientApp").controller("RatesController",function(ratesFactory,$scope){$scope.rates,$scope.year=(new Date).getFullYear(),$scope.currentList=[],$scope.oldList=[],$scope.currentClass=0,ratesFactory.getRates(function(response,success){success?$scope.rates=response:new Notification("Error al obtener las tarifas")}),$scope.showRates=function(classRate){$scope.currentClass===Number(classRate)?($scope.currentClass=0,$scope.currentList=[],$scope.oldList=[]):($scope.currentClass=Number(classRate),$scope.currentList=$scope.rates[classRate].filter(function(item){return!item.isOld}),$scope.oldList=$scope.rates[classRate].filter(function(item){return item.isOld}))},$scope.hideFirstInRow=function(classRate,row){var numberClass=Number(classRate);return!!$scope.currentClass&&Math.floor(($scope.currentClass-1)/row)<Math.floor((numberClass-1)/row)},$scope.hideLastClass=function(classRate){return!$scope.currentClass||$scope.currentClass>=Number(classRate)},$scope.hideLastInRow=function(classRate,row){return!$scope.currentClass||$scope.currentClass>Number(classRate)||Math.floor(($scope.currentClass-1)/row)===Math.floor((Number(classRate)-1)/row)}})}();
!function(){"use strict";angular.module("soatClientApp").factory("ratesFactory",["$http","ENV",function($http,ENV){return{getRates:function(callback){var URL=ENV.soatLandingURL+ENV.getRates;return $http.get(URL).then(function(response){callback(response.data,!0)}).catch(function(errorResponse){callback(errorResponse,!1)})}}}])}();
!function(){"use strict";angular.module("soatClientApp").controller("VoucherController",function($scope,$state,Notification,$routeParams,headerFactory){$scope.transactionId=$state.params.id,$scope.goToFistrPage=function(){$state.go("header.firstPage")};var gtagInit=function(){var response=headerFactory.getInfoSaved();if(response.analytics_key){gtag("config",response.analytics_key,{page_path:"confirmacion"}),ga("send","event","VentaSOAT",$routeParams.transaction_state,$routeParams.description,$routeParams.total);var dimensionValue1=$routeParams.description,dimensionValue2=$routeParams.cod_tarifa,dimensionValue3=$routeParams.transaction_state,dimensionValue4=$scope.transactionId;ga("set","dimension1",dimensionValue1),ga("set","dimension2",dimensionValue2),ga("set","dimension3",dimensionValue3),ga("set","dimension4",dimensionValue4)}},initScript=function(analyticsKey){var key=analyticsKey,script=document.createElement("script");script.type="text/javascript",script.src="https://www.googletagmanager.com/gtag/js?id="+key,(document.head||document.getElementsByTagName("head")[0]).appendChild(script);var script2=document.createElement("script");script2.type="text/javascript",script2.innerHTML="window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());",(document.head||document.getElementsByTagName("head")[0]).appendChild(script2),setTimeout(function(){gtagInit()},2e3)},response=headerFactory.getInfoSaved(),checkExist=setInterval(function(){response=headerFactory.getInfoSaved(),response.analytics_key&&(initScript(response.analytics_key),clearInterval(checkExist))},1e3)})}();
!function(){"use strict";angular.module("soatClientApp").controller("FirstStepController",function($scope,$state,$stateParams,Notification,firstPageFactory,firstStepFactory,headerFactory){if($scope.vehicle=firstPageFactory.getVehicleSaved(),!$scope.vehicle)return void $state.go("header.firstPage");$scope.step=1,$scope.totalWithDiscount,$scope.optionClassSelected,void 0!==$scope.vehicle.optionClass&&($scope.optionClassSelected=String($scope.vehicle.optionClass)),$scope.calcDiscount=function(){const policies=$scope.vehicle.policies;for(var k=0;k<policies.length;k++)policies[k].amount_discount?policies[k].amount_discount>100?policies[k].amount_with_discount=policies[k].amount+policies[k].amount_discount:policies[k].amount_with_discount=100*policies[k].amount/(100-policies[k].amount_discount):policies[k].amount_with_discount=policies[k].amount},$scope.calcDiscount(),$scope.goToSecondStep=function(){if($scope.optionClassSelected){$scope.vehicle.optionClass=Number($scope.optionClassSelected);const policy=$scope.vehicle.policies[$scope.vehicle.optionClass];firstStepFactory.getQuotation(policy.id,function(response){const newData=response.data;policy.descripcion_causal=newData.descripcion_causal,policy.cod_causal=newData.cod_causal,policy.imp_descuento_ley=newData.imp_descuento_ley,policy.pje_descuento_ley=newData.pje_descuento_ley,policy.amount=newData.amount,$state.go("header.secondStep",$stateParams)})}else new Notification("Seleccione un tipo de vehículo")};!function(){var response=headerFactory.getInfoSaved();response.analytics_key&&gtag("config",response.analytics_key,{page_path:"first-step"})}()})}();
!function(){"use strict";angular.module("soatClientApp").factory("firstStepFactory",["$http","ENV",function($http,ENV){return{getQuotation:function(idPolicy,callback){var URL=ENV.soatURL+ENV.getPolicies+"/"+idPolicy+"/complete_quotation";return $http.get(URL).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})}}}])}();
!function(){"use strict";angular.module("soatClientApp").controller("SecondStepController",function(firstPageFactory,$scope,$state,Notification,secondStepFactory,$timeout,headerFactory){if($scope.vehicle=firstPageFactory.getVehicleSaved(),$scope.step=2,!$scope.vehicle)return void $state.go("header.firstPage");$scope.idType="Cédula",$scope.types=["Cédula","NIT","Cédula extranjeria","Tarjeta","Pasaporte"],$scope.cities=[],$scope.citiesName=[],$scope.cityId=null,$scope.businessName,$scope.address,$scope.name,$scope.lastName,$scope.phone,$scope.email,$scope.idNumber,$scope.blockData=!1,$scope.showInputs=!1,$scope.getCities=function(){secondStepFactory.getAllCities(function(response){$scope.cities=response.data.cities,$scope.citiesName=$scope.cities.map(function(department){return department.name}),$scope.vehicle.owner||($scope.cityOption=$scope.cities[0].name),$scope.initTypeSelect()})},$scope.getCities(),$scope.initLocalParams=function(){$scope.vehicle.owner.person.name&&($scope.name=$scope.vehicle.owner.person.name),$scope.vehicle.owner.person.last_name&&($scope.lastName=$scope.vehicle.owner.person.last_name),$scope.vehicle.owner.person.id_number&&($scope.idNumber=Number($scope.vehicle.owner.person.id_number)),$scope.vehicle.owner.address&&($scope.address=$scope.vehicle.owner.address),$scope.vehicle.owner.email&&($scope.email=$scope.vehicle.owner.email),$scope.vehicle.owner.phone&&($scope.phone=$scope.vehicle.owner.phone),$scope.vehicle.owner.person.business_name&&($scope.businessName=$scope.vehicle.owner.person.business_name);for(var i=0;i<$scope.cities.length;i++)$scope.cities[i].id===$scope.vehicle.owner.city&&($scope.cityOption=$scope.cities[i].name,$scope.cityId=$scope.vehicle.owner.city);switch($scope.vehicle.owner.id_document){case"nit":$scope.idType="NIT";break;case"cedula":$scope.idType="Cédula";break;case"cedulaextranjeria":$scope.idType="Cédula extranjeria";break;case"tarjeta":$scope.idType="Tarjeta";break;case"pasaporte":$scope.idType="Pasaporte"}$scope.blockData=!$scope.vehicle.owner.editable},$scope.goToThirdStep=function(){if(!$scope.validateIdNumber())return void new Notification("La cédula no corresponde a la asociada al vehiculo.");var info=$scope.getSecondStepInfo();if(!$scope.cityId||$scope.cityId<0)return void new Notification("Seleccione una ciudad");secondStepFactory.patchOwners(info,function(response){200===response.status||304===response.status?$state.go("header.thirdStep",{secondStepData:info}):409===response.status?new Notification("El vehículo se encuentra asociado a un propietario con email distinto al proporcionado."):502===response.status?new Notification("No se obtuvo respuesta satisfactoria del WS de consulta."):422===response.status&&new Notification("Verifique la información ingresada."),$scope.dataLoading=!1})},$scope.getSecondStepInfo=function(){for(var i=0;i<$scope.cities.length;i++)$scope.cities[i].name===$scope.cityOption&&($scope.cityId=$scope.cities[i].id);var info={email:$scope.email,address:$scope.address,city_id:$scope.cityId,phone:$scope.phone};switch("NIT"===$scope.idType?(info.business_name=$scope.businessName,info.id_number=$scope.idNumber):(info.name=$scope.name,info.last_name=$scope.lastName,info.id_number=$scope.idNumber),$scope.idType){case"NIT":info.id_document="nit";break;case"Cédula":info.id_document="cedula";break;case"Cédula extranjeria":info.id_document="cedulaextranjeria";break;case"Tarjeta":info.id_document="tarjeta";break;case"Pasaporte":info.id_document="pasaporte"}return info},$scope.validateIdNumber=function(){return Number($scope.vehicle.owner.person.id_number)===Number($scope.idNumber)&&("nit"===$scope.vehicle.owner.id_document&&"NIT"===$scope.idType||"cedula"===$scope.vehicle.owner.id_document&&"Cédula"===$scope.idType||"cedulaextranjeria"===$scope.vehicle.owner.id_document&&"Cédula extranjeria"===$scope.idType||"tarjeta"===$scope.vehicle.owner.id_document&&"Tarjeta"===$scope.idType||"pasaporte"===$scope.vehicle.owner.id_document&&"Pasaporte"===$scope.idType)},$scope.fillOwnerData=function(){$scope.validateIdNumber()?($scope.initLocalParams(),$scope.showInputs=!0):$scope.showInputs=!1};const addClickEvent=function(optionDiv,select){optionDiv.addEventListener("click",function(e){var y,s,h;switch(s=this.parentNode.parentNode.getElementsByTagName("select")[0],h=this.parentNode.previousSibling,select){case 0:$scope.idType=this.innerHTML+"";break;case 1:$scope.departmentId=$scope.departments[parseInt(optionDiv.id,10)].id,$scope.departmentOption=$scope.departments[parseInt(optionDiv.id,10)].name,$scope.getCities();break;case 2:$scope.cityId=$scope.cities[parseInt(optionDiv.id,10)].id,$scope.cityOption=$scope.cities[parseInt(optionDiv.id,10)].name}for(var k2=0;k2<s.length;k2++)if(s.options[k2].innerHTML==this.innerHTML){s.selectedIndex=k2,h.innerHTML=this.innerHTML,y=this.parentNode.getElementsByClassName("same-as-selected");for(var a2=0;a2<y.length;a2++)y[a2].removeAttribute("class");this.setAttribute("class","same-as-selected");break}h.click()})};$scope.onlyNumber=function(event){isNaN(Number(event.key))&&event.preventDefault()},$scope.updateIdType=function(value){$timeout(function(){$scope.idType=value,$scope.fillOwnerData()})},$scope.initSelect=function(selectIndex){function closeAllSelect(elmnt){var x,y,i,arrNo=[];for(x=document.getElementsByClassName("select-items"),y=document.getElementsByClassName("select-selected"),i=0;i<y.length;i++)elmnt==y[i]?arrNo.push(i):y[i].classList.remove("select-arrow-active");for(i=0;i<x.length;i++)arrNo.indexOf(i)&&x[i].classList.add("select-hide")}var optionDiv,selectsArray=document.getElementsByClassName("custom-select"),selectElement=selectsArray[selectIndex].getElementsByTagName("select")[0],auxiliarDiv=document.createElement("DIV");if(auxiliarDiv.setAttribute("class","select-selected"),selectElement.selectedIndex=0,"NIT"===$scope.idType&&(selectElement.selectedIndex=1),auxiliarDiv.innerHTML=selectElement.options[selectElement.selectedIndex].innerHTML,selectsArray[selectIndex].getElementsByClassName("select-selected").length&&selectsArray[selectIndex].removeChild(selectsArray[selectIndex].getElementsByClassName("select-selected")[0]),selectsArray[selectIndex].appendChild(auxiliarDiv),!$scope.blockData){var contentOptions=document.createElement("DIV");contentOptions.setAttribute("class","select-items select-hide");for(var a=0;a<selectElement.length;a++)optionDiv=document.createElement("DIV"),optionDiv.setAttribute("id",a),optionDiv.innerHTML=selectElement.options[a].innerHTML,addClickEvent(optionDiv,selectIndex),contentOptions.appendChild(optionDiv);selectsArray[selectIndex].getElementsByClassName("select-items").length&&selectsArray[selectIndex].removeChild(selectsArray[selectIndex].getElementsByClassName("select-items")[0]),selectsArray[selectIndex].appendChild(contentOptions),auxiliarDiv.addEventListener("click",function(e){var element_inner_text=e.srcElement.innerText;element_inner_text&&$scope.updateIdType(element_inner_text),e.stopPropagation(),closeAllSelect(this),this.nextSibling.classList.toggle("select-hide"),this.classList.toggle("select-arrow-active")}),document.addEventListener("click",closeAllSelect)}},$scope.initTypeSelect=function(){var checkExist=setInterval(function(){document.getElementsByClassName("custom-select").length&&($scope.initSelect(0),clearInterval(checkExist))},100)},$scope.goToFirstStepClick=function(){var info=$scope.getSecondStepInfo();$state.go("header.firstStep",{secondStepData:info})};!function(){var response=headerFactory.getInfoSaved();response.analytics_key&&gtag("config",response.analytics_key,{page_path:"second-step"})}()})}();
!function(){"use strict";angular.module("soatClientApp").factory("secondStepFactory",["$http","ENV",function($http,ENV){var patchOwners=function(request,callback){var URL=ENV.soatURL+ENV.patchOwners;return $http.patch(URL,request).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})},getDepartments=function(callback){var URL=ENV.soatURL+ENV.getDepartments;return $http.get(URL).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})};return{getCities:function(idDepartment,callback){var URL=ENV.soatURL+ENV.getDepartments+"/"+idDepartment+ENV.getCities;return $http.get(URL).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})},patchOwners:patchOwners,getDepartments:getDepartments,getAllCities:function(callback){var URL=ENV.soatURL+"/cities";return $http.get(URL).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})}}}])}();
!function(){"use strict";angular.module("soatClientApp").controller("ThirdStepController",function(ENV,$scope,$state,$stateParams,Notification,firstPageFactory,thirdStepFactory,headerFactory){if($scope.invalidCoupon=!1,$scope.validCoupon=!1,$scope.coupon="",$scope.totalWithDiscount=0,$scope.loading=!1,$scope.paySection=!1,$scope.siseDiscount=!1,$scope.hasHideDiscount=!1,$scope.serverErrors=[],$scope.discounts=[],$scope.showDiscountModal,$scope.vehicle=firstPageFactory.getVehicleSaved(),$scope.showPaymentButton=!0,!$scope.vehicle)return void $state.go("header.firstPage");$scope.currentPolicy=$scope.vehicle.policies[$scope.vehicle.optionClass],$scope.currentPolicy.valid_from=$scope.currentPolicy.valid_from.substring(0,10),$scope.currentPolicy.valid_until=$scope.currentPolicy.valid_until.substring(0,10),$scope.idPolicy=$scope.currentPolicy.id,$scope.step=3,$scope.isOpen=!1,$scope.dates={from:new Date((new Date).getTime()+864e5)},$scope.dates.to=new Date($scope.dates.from.getFullYear()+1,$scope.dates.from.getMonth(),$scope.dates.from.getDate()-1),$scope.goToPayModal=function(){$scope.optionClassSelected?($scope.vehicle.optionClass=$scope.optionClassSelected,$state.go("header.secondStep")):new Notification("Seleccione un tipo de vehículo")},$scope.createPaymentButton=function(toPay){$scope.munModel=new Object,$scope.munModel.UserId="usrECommerce",$scope.munModel.Currency="COP",$scope.munModel.Description="Compra SOAT "+$scope.currentPolicy.description,$scope.munModel.TotalAmmount=toPay,$scope.munModel.Tax=0,$scope.munModel.TaxReturnBase=0,$scope.munModel.PurchaseId=$scope.idPolicy,$scope.munModel.BuyerEmail=$scope.vehicle.owner.email,$scope.munModel.UrlResponse=ENV.soatPaymentURL,$scope.munModel.ReferenciasPago=[$scope.vehicle.plate],$scope.munModel.urlConfirmation=ENV.soatPaymentURL},$scope.getPaymentAvailable=function(){thirdStepFactory.getPaymentAvailability($scope.idPolicy,function(response){$scope.showPaymentButton=response.data.is_payment_available;var errors=response.data.errors;if(errors)for(var k=0;k<errors.length;k++)$scope.serverErrors.push(errors[k].descripcion_error);$scope.totalWithDiscount=response.data.imp_total_pagar,$scope.createPaymentButton(response.data.imp_total_pagar),$scope.loading=!1,$scope.paySection=!0})},$scope.validatePayment=function(){if($scope.loading=!0,$scope.validCoupon=!1,$scope.invalidCoupon=!1,$scope.totalWithDiscount=$scope.currentPolicy.amount,$scope.coupon){var params={code:$scope.coupon};thirdStepFactory.putDiscount($scope.idPolicy,params,function(response){404===response.status||422===response.status?($scope.validCoupon=!1,$scope.invalidCoupon=!0,$scope.loading=!1):200===response.status&&(response.data.discount.by?$scope.totalWithDiscount=$scope.currentPolicy.amount-response.data.discount.amount:$scope.totalWithDiscount=(100-response.data.discount.amount)/100*$scope.currentPolicy.amount,$scope.invalidCoupon=!1,$scope.validCoupon=!0,$scope.getPaymentAvailable())})}else $scope.getPaymentAvailable()},$scope.goToFirstStepClick=function(){$state.go("header.firstStep",$stateParams)},$scope.goToSecondStepClick=function(){$state.go("header.secondStep",$stateParams)},$scope.getDiscounts=function(){$scope.currentPolicy.amount_discount||$scope.currentPolicy.imp_descuento_ley?($scope.totalWithDiscount=$scope.currentPolicy.amount,$scope.siseDiscount=!0):thirdStepFactory.getDiscounts($scope.idPolicy,function(response){200===response.status&&($scope.discounts=response.data.discounts,$scope.showDiscountModal=0!==$scope.discounts.length,$scope.hasHideDiscount=response.data.has_discounts)})},$scope.getDiscounts();!function(){var response=headerFactory.getInfoSaved();response.analytics_key&&gtag("config",response.analytics_key,{page_path:"third-step"})}()})}();
!function(){"use strict";angular.module("soatClientApp").factory("thirdStepFactory",["$http","ENV",function($http,ENV){return{getPaymentAvailability:function(idPolicy,callback){var URL=ENV.soatURL+ENV.getPolicies+"/"+idPolicy+ENV.getPaymentAvailability;return $http.get(URL).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})},putDiscount:function(idPolicy,params,callback){var URL=ENV.soatURL+ENV.getPolicies+"/"+idPolicy+ENV.putDiscounts;return $http.put(URL,params).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})},getDiscounts:function(idPolicy,callback){var URL=ENV.soatURL+ENV.getPolicies+"/"+idPolicy+ENV.putDiscounts;return $http.get(URL).then(function(response){callback(response)}).catch(function(errorResponse){callback(errorResponse)})}}}])}();